## –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ8 ¬´–£—Ç–∏–ª–∏—Ç–∞ envdir¬ª

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É `envdir` –Ω–∞ Go.

–° –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º—ã, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–æ–≤ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤ –∫–∞—Ç–∞–ª–æ–≥–µ.

–ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞:

```bash
$ go-envdir /path/to/env/dir command arg1 arg2
```
*go-envdir* - —É—Ç–∏–ª–∏—Ç–∞  
*/path/to/env/dir* - –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∞–π–ª–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è  
*command* - –∑–∞–ø—É—Å–∫–∞–µ–º–∞—è —É—Ç–∏–ª–∏—Ç–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–∞  
*arg1 arg2* - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞–µ–º–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã  

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- —É—Ç–∏–ª–∏—Ç–∞ `envdir` —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ `T`, —Ñ–∞–π–ª–æ–≤ —Å –∏–º–µ–Ω–µ–º `S` –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ —É—Ç–∏–ª–∏—Ç–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
- `envdir` —É–¥–∞–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã —Å –∏–º–µ–Ω–µ–º `S`, –µ—Å–ª–∏ —Ç–∞–∫–æ–≤–∞—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `envdir` –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã —Å –∏–º–µ–Ω–µ–º `S` –∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º `T`, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –ø—É—Å—Ç–æ–π;
- –∏–º—è `S` –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å `=`;
- –ø—Ä–æ–±–µ–ª—ã –∏ —Ç–∞–±—É–ª—è—Ü–∏—è –≤ –∫–æ–Ω—Ü–µ `T` —É–¥–∞–ª—è—é—Ç—Å—è;
- —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ –Ω—É–ª–∏ –≤ `T` (`0x00`) –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏ (`\n`);
- —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞/–æ—à–∏–±–æ–∫ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–ª–∏—Å—å –≤ –≤—ã–∑—ã–≤–∞–µ–º—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É;
- –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ —É—Ç–∏–ª–∏—Ç—ã –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–æ–¥–æ–º –≤—ã—Ö–æ–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ / –æ—à–∏–±–∫–∏.

–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ `testdata` –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ / —Ñ–∞–π–ª—ã,
–∫–æ—Ç–æ—Ä—ã–µ **–æ–±—è–∑–∞–Ω—ã** –ø–æ–¥—á–∏—â–∞—Ç—å –ø–æ—Å–ª–µ —Å–≤–æ–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---
–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```bash
$ go-envdir /path/to/env/dir command arg1 arg2
```
–ï—Å–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/path/to/env/dir` —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è —Ñ–∞–π–ª—ã:
* `FOO` —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º `123`;
* `BAR` —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º `value`,

—Ç–æ –≤—ã–∑–æ–≤ –≤—ã—à–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω –≤—ã–∑–æ–≤—É
```bash
$ FOO=123 BAR=value command arg1 arg2
```
---


### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏
- –ü–∞–π–ø–ª–∞–π–Ω –∑–µ–ª—ë–Ω—ã–π - 4 –±–∞–ª–ª–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã - –¥–æ 4 –±–∞–ª–ª–æ–≤
- –ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å –∏ —á–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞ - –¥–æ 2 –±–∞–ª–ª–æ–≤

#### –ó–∞—á—ë—Ç –æ—Ç 7 –±–∞–ª–ª–æ–≤

### –ü–æ–¥—Å–∫–∞–∑–∫–∏
- https://www.unix.com/man-page/debian/8/envdir/
- `os.Args`
- `os.ReadDir`
- `bytes.Replace`, `strings.TrimRight`
- `exec.Command`


# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã `go-envdir`**  

#### **1. –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏**  
```bash
mkdir -p ~/app_config  # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
cd ~/app_config
```

#### **2. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª—ã**  
–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª = –æ–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è.  

```bash
# –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
echo -n "production" > APP_ENV          # –ë–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –∫–æ–Ω—Ü–µ
echo -n "postgres://localhost:5432" > DB_URL  
echo -n "my_secret_key" > API_KEY      # –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
touch DEBUG                            # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª ‚Üí —É–¥–∞–ª–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DEBUG
```

#### **3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ**  
```bash
ls -la ~/app_config
```
–í—ã–≤–æ–¥:  
```
APP_ENV    # "production"  
DB_URL     # "postgres://localhost:5432"  
API_KEY    # "my_secret_key"  
DEBUG      # (–ø—É—Å—Ç–æ–π —Ñ–∞–π–ª)  
```

---

### **4. –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ `go-envdir`**  
**–§–æ—Ä–º–∞—Ç:**  
```bash
./go-envdir <–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è_—Å_–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏> <–∫–æ–º–∞–Ω–¥–∞> [–∞—Ä–≥—É–º–µ–Ω—Ç—ã]
```

#### **–ü—Ä–∏–º–µ—Ä 1: –í—ã–≤–æ–¥ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (`printenv`)**  
```bash
./go-envdir ~/app_config printenv | grep -E 'APP_ENV|DB_URL|API_KEY|DEBUG'
```
–í—ã–≤–æ–¥:  
```
APP_ENV=production
DB_URL=postgres://localhost:5432
API_KEY=my_secret_key
```
(–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DEBUG` —É–¥–∞–ª–µ–Ω–∞, —Ç.–∫. —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π).  

#### **–ü—Ä–∏–º–µ—Ä 2: –ó–∞–ø—É—Å–∫ Python-—Å–∫—Ä–∏–ø—Ç–∞**  
```bash
./go-envdir ~/app_config python3 -c "import os; print(os.getenv('DB_URL'))"
```
–í—ã–≤–æ–¥:  
```
postgres://localhost:5432
```

#### **–ü—Ä–∏–º–µ—Ä 3: –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (`DEBUG`)**  
```bash
export DEBUG="some_value"  # –î–æ–±–∞–≤–ª—è–µ–º DEBUG –≤ —Ç–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
./go-envdir ~/app_config bash -c 'echo $DEBUG'
```
–í—ã–≤–æ–¥:  
```
(–ø—É—Å—Ç–æ, —Ç.–∫. DEBUG —É–¥–∞–ª—ë–Ω)
```

---

### **5. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**  
1. **–ß—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**  
   - –£—Ç–∏–ª–∏—Ç–∞ —á–∏—Ç–∞–µ—Ç **–∫–∞–∂–¥—ã–π —Ñ–∞–π–ª** –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.  
   - –ò–º—è —Ñ–∞–π–ª–∞ = –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (`APP_ENV`, `DB_URL` –∏ —Ç.–¥.).  
   - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ = –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.  

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π**  
   - **–ü—É—Å—Ç–æ–π —Ñ–∞–π–ª** ‚Üí –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è.  
   - **–ü—Ä–æ–±–µ–ª—ã/—Ç–∞–±—ã –≤ –∫–æ–Ω—Ü–µ** ‚Üí –æ–±—Ä–µ–∑–∞—é—Ç—Å—è.  
   - **–°–∏–º–≤–æ–ª `\x00`** ‚Üí –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `\n` (–ø–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏).  

3. **–ó–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥—ã**  
   - –ü–æ–¥–º–µ–Ω—è–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–µ.  
   - –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç `stdin/stdout/stderr`.  
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã.  

---

### **6. –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**  
```bash
rm -rf ~/app_config  # –û—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```

---

### **–ò—Ç–æ–≥**  
‚úÖ **`go-envdir` –∑–∞–º–µ–Ω—è–µ—Ç —Ä—É—á–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:**  
```bash
# –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:
APP_ENV=production DB_URL=postgres://localhost:5432 ./myapp

# –î–µ–ª–∞–µ–º —Ç–∞–∫:
./go-envdir ~/app_config ./myapp
```
**–ü–ª—é—Å—ã:**  
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ (–Ω–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–∞–Ω–¥).  
- –£–¥–æ–±–Ω–æ (–≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–∞—Ö).  
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏).  

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è:  
- –ó–∞–ø—É—Å–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ (`./go-envdir config node server.js`).  
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –≤ Docker.  
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º–∏.  

–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ! üöÄ